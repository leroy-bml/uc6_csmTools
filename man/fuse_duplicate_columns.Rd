% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/merge_tbls.R
\name{fuse_duplicate_columns}
\alias{fuse_duplicate_columns}
\title{Fuse Identical Columns in a Data Frame}
\usage{
fuse_duplicate_columns(df, sep = "-")
}
\arguments{
\item{df}{A data frame in which to fuse columns. Expected column names may contain a separator and suffix
(e.g., "variable-suffix").}

\item{sep}{A character string used as the separator between the base name and suffix in column names (default: "-").
This separator helps in identifying columns belonging to the same logical variable.}
}
\value{
A data frame with columns consolidated.
If columns sharing a base name are identical across all rows, one representative is kept, named after the base name.
If they are not identical, their values are concatenated into a single column, named after the base name.
A \code{flag_discrepancy} column is added (if discrepancies exist) listing the base names
for rows where values were inconsistent. If no discrepancies are found, \code{flag_discrepancy} is removed.
}
\description{
Identifies groups of columns in a data frame that share a common base name (e.g., "Var-x", "Var-y" would have base "Var")
and consolidates them based on whether their values are identical or not. It also adds a flag column
indicating rows where values across columns within the same base name group are inconsistent.
}
\details{
The function processes columns in the input data frame (\code{df}) by grouping them based on their "base name"
(the part of the column name before the first occurrence of \code{sep}).

\strong{Processing steps for each base name group:}
\enumerate{
\item \strong{Discrepancy Flagging:} It first examines all columns within a base name group (e.g., \code{A}, \code{A-x}, \code{A-y}).
For each row, if non-missing values across these columns are not all identical, a discrepancy is noted for that row and base name.
\item \strong{Column Fusion:}
\itemize{
\item If \strong{all} columns within a base name group are strictly identical across all rows (as determined by an internal \code{are_identical_cols()} helper, also assumed to be available), only the first column in the group is retained, and it is renamed to the \code{current_base_name}.
\item If \strong{any} columns within a base name group are not strictly identical, their row-wise non-NA values are concatenated into a single new column for that base name group. The concatenated values are separated by \code{" | "}.
}
\item \strong{Single Columns:} Columns that do not have any siblings with the same base name (i.e., they are not part of a "group" with a separator-suffixed name) are kept as is.
\item \strong{Flag Column Generation:} After processing all base name groups, a \code{flag_discrepancy} column is constructed. For each row, this column lists all base names for which discrepancies were detected (concatenated with ";").
\item \strong{Flag Column Cleanup:} If, after processing, the \code{flag_discrepancy} column contains only \code{NA} values (meaning no discrepancies were found across the entire data frame), the column is removed from the final output.
}

This function relies on the internal helper functions \code{are_identical_cols()}.
}
