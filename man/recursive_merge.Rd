% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reshape_exp_data.R
\name{recursive_merge}
\alias{recursive_merge}
\title{Iteratively Merge Leaf Tables into a Database Backbone}
\usage{
recursive_merge(db, drop_keys = FALSE, exclude_cols = NULL)
}
\arguments{
\item{db}{A named list of data frames representing the database. Each data frame corresponds to a table.}

\item{drop_keys}{Logical. If \code{TRUE}, drops the join key columns after successful merges (default: \code{FALSE}).}

\item{exclude_cols}{Optional character vector of column names to exclude from being considered or used as join keys during the merge process.}
}
\value{
A list of data frames representing the melted (fully merged) database. The number of tables in the output
will typically be less than or equal to the input, with related data consolidated.
}
\description{
Iteratively merges "leaf" tables (those without children and potentially standalone tables) into their parent tables in a database,
using primary keys and a referential merging strategy. The process continues until no mergeable tables remain.
This function aims to "flatten" a relational database structure into a more consolidated format.
}
\details{
The function operates in an iterative loop, attempting to merge tables based on their relationships:
\itemize{
\item \strong{Initial Root Merge:} It first identifies and merges tables categorized as "root" (tables that are referenced by other tables but do not themselves reference any other tables within the database backbone). This initial step helps to consolidate base data.
\item \strong{Iterative Branch and Leaf Merging:} In a \code{repeat} loop, the function continuously categorizes tables as "branch" (tables that reference other tables and are referenced by others) or "leaf"/"standalone" (tables that reference other tables but are not referenced by any).
\itemize{
\item It identifies "leaf" and "standalone" tables that can be merged into existing "branch" tables based on referential integrity.
\item These identified mergeable tables are then merged into the \code{db} using \code{merge_db_tables} with a "referential" type.
\item The loop continues until no more "leaf" or "standalone" tables can be merged, indicating that the database structure has been consolidated as much as possible through this method.
}
\item \strong{Flag Column Cleanup:} Finally, after all merges are complete, it checks for a \code{flag} column in each resulting data frame. If the \code{flag} column contains only \code{NA} values, it is removed, otherwise it is retained and moved to the end of the data frame.
}

This function relies on several internal helper functions: \code{categorize_tables()}, \code{merge_db_tables()}, \code{get_pkeys()}, and \code{check_ref_integrity()}.
}
