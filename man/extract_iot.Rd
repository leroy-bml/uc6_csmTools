% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_transform_iot.R
\name{extract_iot}
\alias{extract_iot}
\title{Extract and Format IoT Observational Data from OGC SensorThings API}
\usage{
extract_iot(
  url,
  token = NULL,
  var = c("air_temperature", "solar_radiation", "rainfall"),
  lon,
  lat,
  from,
  to,
  format = "icasa"
)
}
\arguments{
\item{url}{Character. The base URL of the OGC SensorThings API endpoint (should end with a slash).}

\item{token}{Character or NULL. The Bearer token for authentication, or NULL to attempt retrieval via \code{get_kc_token}.}

\item{var}{Character vector. The names of observed properties (variables) to extract (e.g., \code{c("air_temperature", "solar_radiation", "rainfall")}).}

\item{lon}{Numeric. Longitude of the target location.}

\item{lat}{Numeric. Latitude of the target location.}

\item{from}{Character or Date. Start date of the desired time range (inclusive).}

\item{to}{Character or Date. End date of the desired time range (inclusive).}

\item{format}{Character. Output format for the data. Either \code{"default"} (raw merged data) or \code{"icasa"} (mapped to ICASA format). Default is \code{"icasa"}.}
}
\value{
A data frame containing merged observational data for the specified variables, with metadata attached as an attribute. The format depends on the \code{format} argument.
}
\description{
Retrieves, merges, and formats observational data for specified variables, location, and time range from an OGC SensorThings API endpoint.
}
\details{
This function orchestrates the retrieval of datastream metadata and observations for the specified variables, location, and time range. It merges the resulting data frames, optionally maps them to the ICASA format using \code{map_data}, and attaches metadata as an attribute. If \code{token} is NULL, it attempts to retrieve one using \code{get_kc_token}.

The function uses the \strong{httr}, \strong{jsonlite}, \strong{dplyr}, \strong{lubridate}, and other helper functions such as \code{locate_sta_datastreams}, \code{get_all_obs}, and \code{map_data}.
}
\examples{
\dontrun{
extract_iot(
  url = "https://example.com/SensorThings/v1.0/",
  token = "your_access_token",
  var = c("air_temperature", "rainfall"),
  lon = 12.34,
  lat = 56.78,
  from = "2022-01-01",
  to = "2022-12-31",
  format = "icasa"
)
}

}
