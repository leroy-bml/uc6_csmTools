% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reshape_exp_data.R
\name{project_dataset}
\alias{project_dataset}
\title{Split and Merge a List of Data Frames by Group Mapping}
\usage{
project_dataset(db, map = load_map())
}
\arguments{
\item{db}{A named list of data frames, where each data frame represents a section of a dataset
(e.g., "PLOT_DETAILS", "SOIL_MEASUREMENTS"), with column names already mapped to ICASA headers.}

\item{map}{A data frame containing the mapping information, typically loaded via \code{load_map()}.
It must contain at least \code{section}, \code{header}, \code{icasa_header_long}, and \code{icasa_group} columns,
which define how columns in input data frames should be grouped into output sections.}
}
\value{
A named list of data frames, where each element represents a consolidated ICASA group (section).
For example, \code{output$SOIL_PROFILE} would contain all soil profile data gathered from various input sections.
}
\description{
This function takes a named list of data frames (typically representing sections of a dataset, already mapped to ICASA headers)
and further structures them into distinct ICASA groups (sections) by splitting and then merging fragments.
}
\details{
The function processes the input \code{db} list to consolidate data into final ICASA sections.

\strong{Processing Steps:}
\itemize{
\item \strong{Metadata Handling:} The "METADATA" section (if present) is temporarily set aside and re-added at the end.
\item \strong{Data Projection:} For each remaining data frame in \code{db}, the \code{project_dataframe()} helper function is called.
This function is expected to split the input data frame into multiple sub-data frames (fragments),
each corresponding to a specific ICASA group (e.g., "SOIL_PROFILE", "WEATHER_DAILY") based on the \code{map}.
\item \strong{Flattening and Grouping:} All resulting sub-data frames from all input sections are combined into a single flat list.
These fragments are then grouped by their target ICASA group names.
\item \strong{Merging Fragments:} For each unique ICASA group (e.g., "SOIL_PROFILE"), all data frame fragments belonging to that group
are merged using a full outer join (\code{merge(..., all = TRUE)}) on their common columns.
Duplicate rows resulting from the merge are then removed.
\item \strong{Data Cleaning and Key Filtering:}
\itemize{
\item For all merged sections \emph{except} "TREATMENTS", columns that contain only \code{NA} values are removed using \code{remove_all_na_cols()}.
\item Rows with missing values in their primary key (as determined by \code{get_pkeys()}) are filtered out from these sections.
}
\item \strong{Final Assembly:} The initially extracted "METADATA" section, the cleaned data sections, and the "TREATMENTS" section
(which is not subjected to primary key filtering by this function) are combined into the final output list.
}

This function is crucial for transforming section-based data into the hierarchical ICASA group structure.
}
