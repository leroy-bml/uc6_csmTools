% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reshape_exp_data.R
\name{format_to_model}
\alias{format_to_model}
\title{Reformat and Aggregate Experimental Data for a Target Model}
\usage{
format_to_model(dataset, data_model = "icasa", header_type)
}
\arguments{
\item{dataset}{A list of dataframes containing experimental data. Each
dataframe in the list should correspond to a table from the ICASA suite
(e.g., \code{TREATMENTS}, \code{FIELDS}, \code{FERTILIZERS}, etc.).}

\item{data_model}{A character string specifying the target data model.
Currently a placeholder for \code{"icasa"}.}

\item{header_type}{A character string, either \code{"long"} or \code{"short"}, that
specifies the column naming convention to use for key identifiers (e.g.,
\code{"experiment_year"} vs. \code{"EXP_YEAR"}).}
}
\value{
A list of dataframes conforming to the target data model structure.
The list includes the original data sections, but with the management
tables redefined as regime definitions and an updated \code{TREATMENTS} matrix
that links plots to these regimes.
}
\description{
This function processes a list of raw experimental data tables and transforms
them into a structured format suitable for simulation models, specifically
the ICASA standard. It splits data into logical sections, aggregates key
tables (fields, weather), and normalizes complex management schedules by
converting event sequences into distinct management regimes.
}
\details{
The core transformation performed by this function is the aggregation of
management events into "regimes". For each management type (e.g.,
fertilization, tillage), it identifies unique sequences of operations
applied to plots or treatments. These unique sequences (regimes) are
assigned a numeric level. The main \code{TREATMENTS} table is then updated to
map each experimental plot to its corresponding management regime levels.
This simplifies the data structure by abstracting detailed event schedules
into a cross-referenced matrix.

The function also performs the following pre-processing steps:
\itemize{
\item Aggregates spatial data in the \code{FIELDS} table by year.
\item Extracts year information from date columns in the \code{WEATHER_METADATA} table.
}
}
\section{TODO}{

A list of known issues and areas for future improvement:
\itemize{
\item \strong{General:} The aggregation logic currently hardcoded could be moved to a
more flexible \code{yaml} configuration file.
\item \strong{Fields:} Implement a function to handle different coordinate systems and
group field coordinates more robustly.
\item \strong{Soil:} The soil data section (\code{SOIL_METADATA}, \code{SOIL_LAYERS}) is not yet
processed. The unpractical profile/analysis/measured split in the ICASA
standard needs to be handled.
}
}

