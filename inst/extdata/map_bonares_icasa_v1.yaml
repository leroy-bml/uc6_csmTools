# BonaRes-LTE to ICASA data map (v0.0.9; verbose)

# ---- Phase 1: Data Transformation Rules ---

## --- SECTION METADATA

- mapping_uid: '1'
  notes: "Pass through all columns that only need renaming."
  source:
    section: METADATA
  target:
    section: GENERAL
  actions:
    - type: pass_through
      headers:
        - Experiment_name
        - header: METADATA.Abstract  # Note: add into read_metadata
          synonyms:
            - METADATA.Summary
        - METADATA.Date_published
        - METADATA.Date_revised
        - METADATA.Funding
        - METADATA.Legal_constrainsts
        - METADATA.Date_published
        - METADATA.Date_revised
        
- mapping_uid: '2'
  notes: "Pass through all columns that only need renaming."
  source:
    section: PERSONS
  target:
    section: PERSONS
  actions:
    - type: pass_through
      headers:
        - PERSONS.Contact_email

- mapping_uid: '3'
  notes: "Pass through all columns that only need renaming."
  source:
    section: INSTITUTIONS
  target:
    section: INSTITUTIONS
  actions:
    - type: pass_through
      headers:
        - Institutions

- mapping_uid: '4'
  notes: "Pass through all columns that only need renaming."
  source:
    section: METADATA
  target:
    section: DOCUMENTS
  actions:
    - type: pass_through
      headers:
        - METADATA.Experiment_doi

- mapping_uid: '5'
  notes: "Split full name into first, middle, and last name components."
  source:
    section: PERSONS
    header: Contact_persons
  target:
    section: PERSONS
  actions:
    - type: split_and_map_text
      output_map:
        - {output_header: researcher_first_name, component: first}
        - {output_header: researcher_last_name, component: last}
        - {output_header: researcher_name_mi, component: middle}
      delimiter: " "

## --- SECTION TREATMENTS

- mapping_uid: '10'
  notes: "Pass through all columns that only need renaming."
  source:
    section: VERSUCHSAUFBAU
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      - Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - PARZELLE.Wiederholung
        - FAKTOR1_STUFE.Name
        - FAKTOR1_STUFE.Beschreibung
        - FAKTOR2_STUFE.Name
        - FAKTOR2_STUFE.Beschreibung
        - FAKTOR3_STUFE.Name
        - FAKTOR3_STUFE.Beschreibung
        #- BEMERKUNGEN.Bemerkungen  # Note: separate from Beschreibung?

- mapping_uid: '11'
  source:
    section: TREATMENTS
    keys: 
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      - Kultur_ID
    header: PARZELLE.Mittelpunkt_x_GK
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
    - type: add_column
      output_header: coordinate_system
      value: 'GK'
      target_section: TREATMENTS

- mapping_uid: '12'
  source:
    section: TREATMENTS
    keys: 
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      - Kultur_ID
    header: PARZELLE.Mittelpunkt_y_GK
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
    - type: add_column
      output_header: coordinate_system
      value: 'GK'
      target_section: TREATMENTS

- mapping_uid: '13'
  notes: "Pass through management and resources IDs."
  source:
    section: AUSSAAT
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      - Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Aussaat_ID
        - Sorte_ID

- mapping_uid: '14'
  notes: "Pass through management and resources IDs."
  source:
    section: BEREGNUNG
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      #- Kultur_ID  # Note: optional key (?)
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Beregnung_ID

- mapping_uid: '15'
  notes: "Pass through management and resources IDs."
  source:
    section: DUENGUNG
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      #- Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Duengung_ID  # Note: branching duplicate with OM?

- mapping_uid: '16'
  notes: "Pass through management and resources IDs."
  source:
    section: PFLANZENSCHUTZ
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      #- Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Pflanzenschutz_ID

- mapping_uid: '17'
  notes: "Pass through management and resources IDs."
  source:
    section: BODENBEARBEITUNG
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      #- Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Bodenbearbeitung_ID

- mapping_uid: '18'
  notes: "Pass through management and resources IDs."
  source:
    section: ERTRAG
    keys:
      - Pruefglied_ID
      - Versuchsjahr
      - Parzelle_ID
      - Kultur_ID
  target:
    section: TREATMENTS
  actions:
    - type: pass_through
      headers:
        - Ernte_ID

- mapping_uid: '19'
  source:
    section: VERSUCHSAUFBAU
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Icc_Code
  target:
    section: TREATMENTS
  actions:
    - type: map_values
      map:
        '1.01': 'WHT'
        '1.02': 'MAZ'
        '1.05': 'BAR'
        '5.01': 'POT'
        '8.01': 'SBT'

- mapping_uid: '20'
  source:
    section: VERSUCHSAUFBAU
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Kultur
  target:
    section: TREATMENTS
  actions:
    - type: map_values
      map:
        'Winterweizen': 'WHT'
        'Sommerweizen': 'WHT'
        'Körnermais': 'MAZ'
        'Wintergerste': 'BAR'
        'Sommergerste': 'BAR'
        'Kartoffel': 'POT'
        'Zuckerrübe': 'SBT'

## --- SECTION FIELDS

- mapping_uid: '30'
  notes: "Pass through individual plot coordinates to the FIELDS table for post-processing."
  source:
    section: VERSUCHSAUFBAU
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: FIELDS
  actions:
    - type: pass_through
      headers:
        - PARZELLE.Mittelpunkt_x_GK
        - PARZELLE.Mittelpunkt_y_GK
        - PARZELLE.Hoehenlage_Min
        - PARZELLE.Hoehenlage_Max
    - type: add_column
      output_header: coordinate_system
      value: 'GK'

### Note: add field_level + str variables?

## --- SECTION GENOTYPES

- mapping_uid: '40'
  notes: "Pass through all columns that only need renaming."
  source:
    section: AUSSAAT  # Note: or ERTRAG?
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
  target:
    section: GENOTYPES
  actions:
    - type: pass_through
      headers:
        - Sorte_ID
        - SORTE.Sorte

- mapping_uid: '41'
  source:
    section: AUSSAAT  # Note: or ERTRAG?
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Icc_Code
  target:
    section: GENOTYPES
  actions:
    - type: map_values
      map:
        '1.01': 'WHT'
        '1.02': 'MAZ'
        '1.05': 'BAR'
        '5.01': 'POT'
        '8.01': 'SBT'

- mapping_uid: '42'
  source:
    section: AUSSAAT  # Note: or ERTRAG?
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Kultur
  target:
    section: GENOTYPES
  actions:
    - type: map_values
      map:
        'Winterweizen': 'WHT'
        'Sommerweizen': 'WHT'
        'Körnermais': 'MAZ'
        'Wintergerste': 'BAR'
        'Sommergerste': 'BAR'
        'Kartoffel': 'POT'
        'Zuckerrübe': 'SBT'

## --- SECTION PLANTINGS

- mapping_uid: '50'
  notes: "Pass through all columns that only need renaming."
  source:
    section: AUSSAAT
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
  target:
    section: PLANTINGS
  actions:
    - type: pass_through
      headers:
        - Aussaat_ID
        - SORTE.Sorte
        - AUSSAAT.Termin
        - AUSSAAT.Termin_Aufgang
        - AUSSAAT.Saatstaerke_Anzahl_m2
        - AUSSAAT.Saatstaerke_kg_ha
        - SAAT_PFLANZGUT.Keimfaehigkeit
        - TECHNIK.Technik
        - TECHNIK.Art
        - TECHNIK.Beschreibung
        - AUSSAAT.Reihenabstand
        - AUSSAAT.Pflanzenabstand
        - BEMERKUNGEN.Bemerkungen

- mapping_uid: '51'
  source:
    section: AUSSAAT
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Icc_Code
  target:
    section: PLANTINGS
  actions:
    - type: map_values
      map:
        '1.01': 'WHT'
        '1.02': 'MAZ'
        '1.05': 'BAR'
        '5.01': 'POT'
        '8.01': 'SBT'

- mapping_uid: '52'
  source:
    section: AUSSAAT
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Kultur
  target:
    section: PLANTINGS
  actions:
    - type: map_values
      map:
        'Winterweizen': 'WHT'
        'Sommerweizen': 'WHT'
        'Körnermais': 'MAZ'
        'Wintergerste': 'BAR'
        'Sommergerste': 'BAR'
        'Kartoffel': 'POT'
        'Zuckerrübe': 'SBT'

## --- SECTION IRRIGATIONS

- mapping_uid: '60'
  notes: "Pass through all columns that only need renaming."
  source:
    section: VERSUCHSAUFBAU
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: IRRIGATIONS
  actions:
    - type: pass_through
      headers:
        - VERSUCHSAUFBAU.Bewaesserung

- mapping_uid: '61'
  notes: "Pass through all columns that only need renaming."
  source:
    section: BEREGNUNG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: IRRIGATIONS
  actions:
    - type: pass_through
      headers:
        - Beregnung_ID
        - BEREGNUNG.Termin
        - BEREGNUNG.Menge
        - BEMERKUNGEN.Bemerkungen

## --- SECTIONS FERTILIZERS/ORGANIC_MATERIALS

- mapping_uid: '70'
  notes: 'A complete rule to split and map all fertilizer variables.'
  source:
    section: DUENGUNG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Duengung_ID
  target: {} # No default target
  actions:
    - type: conditional_routing
      routes:
        # --- First Route: for Inorganic Fertilizers ---
        - target_section: FERTILIZERS
          condition_on_presence_of:
            - header: DUENGUNG.Masse_mineralisch
              synonyms: [DUENGUNG.Menge_Duengemittel]
            - header: DUENGUNG.Stickstoff
              synonyms: [DUENGUNG.Stickstoff_min, DUENGUNG.N]
            - header: DUENGUNG.Phosphor
              synonyms: [DUENGUNG.P]
            - header: DUENGUNG.Kalium
              synonyms: [DUENGUNG.K]
          map_columns:
            # Common columns
            - DUENGUNG.Termin
            - header: DUENGUNG.Duengemittel_Name
              synonyms: [DUENGEMITTEL.Name]
            - TECHNIK.Technik
            - TECHNIK.Art
            - TECHNIK.Beschreibung
            - BEMERKUNGEN.Bemerkungen
            # FERTILIZERS-specific columns (pass-through)
            - header: DUENGUNG.Masse_mineralisch
              synonyms: [DUENGUNG.Menge_Duengemittel]
            - header: DUENGUNG.Stickstoff
              synonyms: [DUENGUNG.Stickstoff_min, DUENGUNG.N]
            - header: DUENGUNG.Phosphor
              synonyms: [DUENGUNG.P]
            - header: DUENGUNG.Kalium
              synonyms: [DUENGUNG.K]
            - header: DUENGUNG.Magnesium
              synonyms: [DUENGUNG.Mg]
            - header: DUENGUNG.Schwefel
              synonyms: [DUENGUNG.S]
            - header: DUENGUNG.Kalzium
              synonyms: [DUENGUNG.Calcium, DUENGUNG.Ca]
            - header: DUENGUNG.Bor
              synonyms: [DUENGUNG.B]
            - header: DUENGUNG.Zink
              synonyms: [DUENGUNG.Zn]
            - header: DUENGUNG.Mangan
              synonyms: [DUENGUNG.Mn]
            - header: DUENGUNG.Eisen
              synonyms: [DUENGUNG.Fe]
            
            # FERTILIZERS-specific columns that require transformation
            - source_header: 
                header: DUENGUNG.Diaphosphorpentoxid
                synonyms: [DUENGUNG.Phosphorpentoxid, DUENGUNG.P2O5]
              action:
                type: rowwise_transform
                 # Preserve name temporarily to avoid name collisions
                output_header: DUENGUNG.Diaphosphorpentoxid
                input_map:
                  x:
                    header: DUENGUNG.Diaphosphorpentoxid
                    synonyms: [DUENGUNG.Phosphorpentoxid, DUENGUNG.P2O5]
                formula: "x * 0.436"
            - source_header: 
                header: DUENGUNG.Dikaliumoxid
                synonyms: [DUENGUNG.Kaliumoxid, DUENGUNG.K2O]
              action:
                type: rowwise_transform
                output_header: DUENGUNG.Dikaliumoxid # Corrected: no name collision
                input_map:
                  x:
                    header: DUENGUNG.Dikaliumoxid
                    synonyms: [DUENGUNG.Kaliumoxid, DUENGUNG.K2O]
                formula: "x * 0.830"
            - source_header: 
                header: DUENGUNG.Magnesiumoxid
                synonyms: [DUENGUNG.Magnesia, DUENGUNG.MgO]
              action:
                type: rowwise_transform
                output_header: DUENGUNG.Magnesiumoxid
                input_map:
                  x:
                    header: DUENGUNG.Magnesiumoxid
                    synonyms: [DUENGUNG.Magnesia, DUENGUNG.MgO]
                formula: "x * 0.603"
            - source_header: 
                header: DUENGUNG.Calciumoxid
                synonyms: [DUENGUNG.Gebrannter_Kalk, DUENGUNG.Branntkalk, DUENGUNG.Ungeloeschter_Kalk, DUENGUNG.Kalkerde, DUENGUNG.Aetzkalk, DUENGUNG.Freikalk, DUENGUNG.CaO]
              action:
                type: rowwise_transform
                output_header: DUENGUNG.Calciumoxid # Corrected: no name collision
                input_map:
                  x:
                    header: DUENGUNG.Calciumoxid
                    synonyms: [DUENGUNG.Gebrannter_Kalk, DUENGUNG.Branntkalk, DUENGUNG.Ungeloeschter_Kalk, DUENGUNG.Kalkerde, DUENGUNG.Aetzkalk, DUENGUNG.Freikalk, DUENGUNG.CaO]
                formula: "x * 0.715"

        # --- Second Route: for Organic Fertilizers ---
        - target_section: ORGANIC_MATERIALS
          condition_on_presence_of:
            - DUENGUNG.Frischmasse
            - DUENGUNG.Trockenmasse
            - DUENGUNG.Trockensubstanz
            - DUENGUNG.Stickstoff_In_Frischmasse
            - DUENGUNG.Stickstoff_In_Trockenmasse
          map_columns:
            # Common columns
            - DUENGUNG.Termin
            - TECHNIK.Technik
            - TECHNIK.Art
            - TECHNIK.Beschreibung
            - BEMERKUNGEN.Bemerkungen
            # ORGANIC-MATERIALS-specific columns
            - DUENGUNG.Trockenmasse
            - DUENGUNG.Trockensubstanz
            - DUENGUNG.Stickstoff_In_Frischmasse
            - DUENGUNG.Stickstoff_In_Trockenmasse
            - DUENGUNG.Phosphor_In_Frischmasse
            - DUENGUNG.Phosphor_In_Trockenmasse
            - DUENGUNG.Kalium_In_Frischmasse
            - DUENGUNG.Kalium_In_Trockenmasse
            - DUENGUNG.Magnesium_In_Frischmasse
            - DUENGUNG.Magnesium_In_Trockenmasse
            # Organic-specific columns that also need transformation
            - source_header: DUENGUNG.Duengemittel_Name
              action:
                type: map_values
                map:
                  'Harnstoff': 'FE005'
                  'Triplesuperphosphat': 'FE014'
                  'Ammon-Sulfat-Salpeter': 'FE060'
                  'Kalkammonsalpeter': 'FE011'
                  'Kalkstickstoff': 'FE050'
                  'Ammonium-Nitrat-Harnstoff-Lösung': 'FE010'
            - source_header: DUENGUNG.Frischmasse
            # Note: can add annotation here?
              action:
                type: rowwise_transform
                output_header: DUENGUNG.Frischmasse
                input_map: {x: DUENGUNG.Frischmasse}
                formula: "x * 1000"
            - source_header: DUENGUNG.Trockenmasse
              action:
                type: rowwise_transform
                output_header: DUENGUNG.Frischmasse
                input_map: {x: DUENGUNG.Frischmasse}
                formula: "x * 100"

## --- SECTION CHEMICALS

- mapping_uid: '80'
  notes: "Pass through all columns that only need renaming."
  source:
    section: PFLANZENSCHUTZ
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: CHEMICALS
  actions:
    - type: pass_through
      headers:
        - Pflanzenschutz_ID
        - PFLANZENSCHUTZ.Termin
        - PFLANZENSCHUTZ.Pflanzenschutzmittel_Name
        - PFLANZENSCHUTZ.Pflanzenschutzmittel_Wirkstoff
        - TECHNIK.Technik
        - TECHNIK.Art
        - TECHNIK.Beschreibung
        - PFLANZENSCHUTZ.Menge_kg_ha
        - PFLANZENSCHUTZ.Menge_l_ha
        - PFLANZENSCHUTZ.Person_Nachname
        - PFLANZENSCHUTZ.Person_Vorname
        - BEMERKUNGEN.Bemerkungen

## --- SECTION TILLAGE

- mapping_uid: '90'
  notes: "Pass through all columns that only need renaming."
  source:
    section: BODENBEARBEITUNG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: TILLAGE
  actions:
    - type: pass_through
      headers:
        - Bodenbearbeitung_ID
        - BODENBEARBEITUNG.Termin
        - header: BODENBEARBEITUNG.Bodenbearbeitung_Massnahme
          synonyms: [BODENBEARBEITUNG_MASSNAHME.Massnahme]
        - TECHNIK.Technik
        - TECHNIK.Art
        - TECHNIK.Beschreibung
        - BODENBEARBEITUNG.Tiefe
        - BEMERKUNGEN.Bemerkungen

## --- SECTION HARVESTS

- mapping_uid: '100'
  notes: "Pass through all columns that only need renaming."
  source:
    section: ERTRAG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
  target:
    section: HARVESTS
  actions:
    - type: pass_through
      headers:
        - Ernte_ID
        - SORTE.Sorte
        - ERNTE.Termin
        - TECHNIK.Technik
        - TECHNIK.Art
        - TECHNIK.Beschreibung
        - BEMERKUNGEN.Bemerkungen

- mapping_uid: '101'
  source:
    section: ERTRAG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Icc_Code
  target:
    section: HARVESTS
  actions:
    - type: map_values
      map:
        '1.01': 'WHT'
        '1.02': 'MAZ'
        '1.05': 'BAR'
        '5.01': 'POT'
        '8.01': 'SBT'

- mapping_uid: '102'
  source:
    section: ERTRAG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: KULTUR.Kultur
  target:
    section: HARVESTS
  actions:
    - type: map_values
      map:
        'Winterweizen': 'WHT'
        'Sommerweizen': 'WHT'
        'Körnermais': 'MAZ'
        'Wintergerste': 'BAR'
        'Sommergerste': 'BAR'
        'Kartoffel': 'POT'
        'Zuckerrübe': 'SBT'

- mapping_uid: '103'
  source:
    section: AUSSAAT
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: AUSSAAT.Vorfrucht
  target:
    section: HARVESTS
  actions:
    - type: add_column_conditional
      output_header: crop_intended_use
      value: 'CO'
      condition:
        operator: equals
        value: 1

- mapping_uid: '104'
  source:
    section: FRUCHTFOLGE
    keys:
      - Versuchsjahr
      - Kultur_ID
    header: FRUCHTFOLGE.Vorfrucht
  target:
    section: HARVESTS
  actions:
    - type: add_column_conditional
      output_header: crop_intended_use
      value: 'CO'
      condition:
        operator: equals
        value: 1

## --- SECTIONS WEATHER_DAILY/WEATHER_METADATA

- mapping_uid: '110'
  notes: "Pass through all columns that only need renaming."
  source:
    section: KLIMADATEN
    keys:
      - KLIMADATEN.Termin
  target:
    section: WEATHER_DAILY
  actions:
    - type: pass_through
      headers:
        - KLIMADATEN.Niederschlag_Summe
        - KLIMADATEN.Sonnenstunden
        - KLIMADATEN.Luftfeuchte
        - KLIMADATEN.Partialdruck
        - KLIMADATEN.Himmel
        - BEMERKUNGEN.Bemerkungen

- mapping_uid: '111'
  notes: 'Convert solar radiation from W/m2 to MJ/m2/d'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.Globalstrahlung
  target:
    section: WEATHER_DAILY
  actions:
    - type: rowwise_transform
      output_header: KLIMADATEN.Globalstrahlung
      input_map:
        x: KLIMADATEN.Globalstrahlung
      formula: "x * 0.0864"

- mapping_uid: '112'
  notes: 'Convert wind speed from m/s to km/d'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.Wind
  target:
    section: WEATHER_DAILY
  actions:
    - type: rowwise_transform
      output_header: KLIMADATEN.Wind
      input_map:
        x: KLIMADATEN.Wind
      formula: "x * 86.4"

- mapping_uid: '113'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.T_Max_2m
  target:
    section: WEATHER_DAILY
  actions:
    - type: pass_through
    - type: add_column
      output_header: temperature_sensor_ht
      value: 2
      target_section: WEATHER_METADATA

- mapping_uid: '114'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.T_Min_2m
  target:
    section: WEATHER_DAILY
  actions:
    - type: pass_through
    - type: add_column
      output_header: temperature_sensor_ht
      value: 2
      target_section: WEATHER_METADATA

- mapping_uid: '115'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.T_Mit_2m
  target:
    section: WEATHER_DAILY
  actions:
    - type: pass_through
    - type: add_column
      output_header: temperature_sensor_ht
      value: 2
      target_section: WEATHER_METADATA

- mapping_uid: '116'
  source:
    section: KLIMADATEN
    keys: 
      - KLIMADATEN.Termin
    header: KLIMADATEN.T_Min_5cm
  target:
    section: WEATHER_DAILY
  actions:
    - type: pass_through
    - type: add_column
      output_header: temperature_sensor_ht
      value: 0.05  ## Note: what if both height sensors?
      target_section: WEATHER_METADATA

## --- SECTIONS SOIL_LAYERS/SOIL_METADATA

- mapping_uid: '120'
  notes: "Pass through all columns that only need renaming."
  source:
    section: BODENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
  target:
    section: SOIL_LAYERS
  actions:
    - type: pass_through
      headers:
        - Bodenlaborwerte_ID
        - PROBENAHME_BODEN.Termin
        - PROBENAHME_BODEN.Obergrenze
        - PROBENAHME_BODEN.Untergrenze
        - BEMERKUNGEN.Bemerkungen

## --- SECTION SUMMARY

- mapping_uid: '130'
  notes: "Pass through all columns that only need renaming."
  source:
    section: ERTRAG
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
  target:
    section: SUMMARY
  actions:
    - type: pass_through
      headers:
        - ERNTE.Termin  ## Note: to add in renaming as HDAT for measured data
        - BEMERKUNGEN.Bemerkungen

- mapping_uid: '131'
  notes: 'Convert main product dry matter yield from dt/ha to kg/ha'
  source:
    section: ERTRAG
    keys: 
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: ERTRAG.Hp_Trockenmasse
  target:
    section: SUMMARY
  actions:
    - type: rowwise_transform
      output_header: ERTRAG.Hp_Trockenmasse
      input_map:
        x: ERTRAG.Hp_Trockenmasse
      formula: "x * 100"

- mapping_uid: '132'
  notes: 'Convert by-product dry matter yield from dt/ha to kg/ha'
  source:
    section: ERTRAG
    keys: 
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: ERTRAG.Np_Trockenmasse
  target:
    section: SUMMARY
  actions:
    - type: rowwise_transform
      output_header: ERTRAG.Np_Trockenmasse
      input_map:
        x: ERTRAG.Np_Trockenmasse
      formula: "x * 100"

- mapping_uid: '133'
  notes: 'Convert main product fresh matter yield from t/ha to kg/ha'
  source:
    section: ERTRAG
    keys: 
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Kultur_ID
    header: ERTRAG.Hp_Frischmasse
  target:
    section: SUMMARY
  actions:
    - type: rowwise_transform
      output_header: ERTRAG.Hp_Frischmasse
      input_map:
        x: ERTRAG.Hp_Frischmasse
      formula: "x * 1000"

## --- SECTION TIME_SERIES

- mapping_uid: '140'
  notes: "Pass through all columns that only need renaming."
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID  # Note: Kultur_ID?
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: pass_through
      headers:
        - PROBENAHME_PFLANZEN.Termin
        - PFLANZENLABORWERTE.Stickstoff
        - PFLANZENLABORWERTE.Phosphor
        - PFLANZENLABORWERTE.Protein
        - PFLANZENLABORWERTE.Oel
        - BEMERKUNGEN.Bemerkungen

- mapping_uid: '141'
  notes: 'Convert main product dry matter yield from dt/ha to kg/ha'
  source:
    section: PFLANZENLABORWERTE
    keys: 
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
    header: PFLANZENLABORWERTE.Hp_Trockenmasse
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: PFLANZENLABORWERTE.Hp_Trockenmasse
      input_map:
        x: PFLANZENLABORWERTE.Hp_Trockenmasse
      formula: "x * 100"

- mapping_uid: '142'
  notes: 'Calculate yield moisture content (%) from fresh yield dry matter content (%).'
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: yield_moisture_content
      input_map:
        dm_conc:
          header: PFLANZENLABORWERTE.Hp_Trockensubstanzgehalt
          synonyms: [PFLANZENLABORWERTE.TS]
      formula: "100 - dm_conc"

- mapping_uid: '143'
  notes: 'Calculate grain N content (kg/ha) from N concentration (%) and dry matter yield (dt/ha)'
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: grain_N_content
      input_map:
        yield: PFLANZENLABORWERTE.Hp_Trockenmasse
        n_conc:
          header: PFLANZENLABORWERTE.Stickstoff
          synonyms: [PFLANZENLABORWERTE.N]
      formula: "(yield * 100) * (n_conc / 100)"

- mapping_uid: '144'
  notes: 'Calculate grain P content (kg/ha) from P concentration (%) and dry matter yield (dt/ha)'
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: grain_P_content
      input_map:
        yield: PFLANZENLABORWERTE.Hp_Trockenmasse
        p_conc:
          header: PFLANZENLABORWERTE.Phosphor
          synonyms: [PFLANZENLABORWERTE.P]
      formula: "(yield * 100) * (p_conc / 100)"

- mapping_uid: '145'
  notes: 'Calculate grain K content (kg/ha) from K concentration (%) and dry matter yield (dt/ha)'
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: grain_K_content
      input_map:
        yield: PFLANZENLABORWERTE.Hp_Trockenmasse
        k_conc:
          header: PFLANZENLABORWERTE.Kalium
          synonyms: [PFLANZENLABORWERTE.K]
      formula: "(yield * 100) * (k_conc / 100)"
  
- mapping_uid: '146'
  notes: 'Calculate grain unit weight (mg) from thousand-grain-weight (g)'
  source:
    section: PFLANZENLABORWERTE
    keys:
      - Versuchsjahr
      - Pruefglied_ID
      - Parzelle_ID
      - Pflanzenlaborwerte_ID
  target:
    section: TIME_SERIES
  actions:
    - type: rowwise_transform
      output_header: grain_unit_weight
      input_map:
        TGW: PFLANZENLABORWERTE.TKG
      formula: "(TGW / 1000) * 1000"  # explicit for transparency (transformation + conversion)

## TODO: conditional mapping ERTRAG to TIME_SERIES (Harvest date to sampling date)
#- mapping_uid: '137'
#  notes: 'Convert main product dry matter yield from dt/ha to kg/ha'
#  source:
#    section: ERTRAG
#    keys: 
#      - Versuchsjahr
#      - Pruefglied_ID
#      - Parzelle_ID
#    header: ERTRAG.Hp_Trockenmasse
#  target:
#    section: TIME_SERIES
#  actions:
#    - type: rowwise_transform
#      output_header: ERTRAG.Hp_Trockenmasse
#      input_map:
#        x: ERTRAG.Hp_Trockenmasse
#      formula: "x * 100"

# --- Phase 2: Schema Application Rule ---

- mapping_uid: '999'
  notes: "Schema application for all output tables."
  actions:
    - type: map_headers
      target_section: GENERAL
      rename_list:
        - {from: Experiment_name, to: name_of_experiment}
        - from: 
            header: METADATA.Abstract
            synonyms: [METADATA.Summary]
        - to: experiment_narrative
        - {from: METADATA.Date_published, to: revision_date_first}
        - {from: METADATA.Date_revised, to: revision_date_latest}
        - {from: METADATA.Funding, to: ex_funding_source}
        # Note: Mapping one source to multiple outputs (distrib_restrictions, ex_license)
        # must be handled in Phase 1 with a branching rule.
        - {from: METADATA.Legal_constrainsts, to: distrib_restrictions}

    - type: map_headers
      target_section: PERSONS
      rename_list:
        - {from: PERSONS.Contact_email, to: e_mail_address}

    - type: map_headers
      target_section: INSTITUTIONS
      rename_list:
        - {from: Institutions, to: institute_name}

    - type: map_headers
      target_section: DOCUMENTS
      rename_list:
        - {from: METADATA.Experiment_doi, to: digital_object_id}

    - type: map_headers
      target_section: TREATMENTS
      rename_list:
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: PARZELLE.Wiederholung, to: replicate_number}
        - {from: PARZELLE.Mittelpunkt_x_GK, to: plot_geocoord_x}
        - {from: PARZELLE.Mittelpunkt_y_GK, to: plot_geocoord_y}
        - {from: coordinate_system, to: plot_geocoord_system}
        - {from: FAKTOR1_STUFE.Name, to: treatment_name}
        - {from: FAKTOR2_STUFE.Name, to: treatment_name}
        - {from: FAKTOR3_STUFE.Name, to: treatment_name}
        - {from: FAKTOR1_STUFE.Beschreibung, to: treatment_comments}
        - {from: FAKTOR2_STUFE.Beschreibung, to: treatment_comments}
        - {from: FAKTOR3_STUFE.Beschreibung, to: treatment_comments}
        - {from: KULTUR.Kultur, to: crop_id}
        - {from: KULTUR.Icc_Code, to: crop_id}
        #- {from: Field_ID, to: field_level}
        #- {from: Soil_analysis_ID, to: soil_analysis_level}
        #- {from: Initial_conditions_ID, to: initial_conditions_level}
        - {from: Sorte_ID, to: genotype_level}
        - {from: Aussaat_ID, to: planting_level}
        - {from: Beregnung_ID, to: irrigation_level}
        - {from: Duengung_ID, to: fertilizer_level}  # Note: handle duplicate Duengung_ID (newvar rename?)
        #- {from: Duengung_ID, to: org_materials_applic_lev}  # Note: handle duplicate Duengung_ID (newvar rename?)
        - {from: Pflanzenschutz_ID, to: chemical_applic_level}
        #- {from: Mulch_ID, to: mulch_level}
        - {from: Bodenbearbeitung_ID, to: tillage_level}
        #- {from: Environ_modif_ID, to: environmental_modif_lev}
        - {from: Ernte_ID, to: harvest_operations_level}
        #- {from: Simulation_controls_ID, to: simulation_control_level}

    - type: map_headers
      target_section: FIELDS
      rename_list:
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        # Assign temporary names (aggregation in next step)
        - {from: PARZELLE.Mittelpunkt_y_GK, to: latitude}
        - {from: PARZELLE.Mittelpunkt_x_GK, to: longitude}
        - {from: PARZELLE.Hoehenlage_Max, to: elevation_max}
        - {from: PARZELLE.Hoehenlage_Min, to: elevation_min}
        - {from: coordinate_system, to: coordinate_system}  # Note: 2025-08-05 not an ICASA term

    - type: map_headers
      target_section: GENOTYPES
      rename_list:
        - {from: Sorte_ID, to: genotype_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: KULTUR.Icc_Code, to: crop_id}
        - {from: KULTUR.Kultur, to: crop_id}
        #- {from: KULTUR.Kultur_Botanisch, to: crop_id}
        #- {from: KULTUR.Kultur_Englisch, to: crop_id}
        - {from: SORTE.Bsa_Code, to: SORTE.BSA_Code}
        - {from: SORTE.Sorte, to: genotype_name}

    - type: map_headers
      target_section: PLANTINGS
      rename_list:
        - {from: Aussaat_ID, to: planting_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: AUSSAAT.Termin, to: planting_date}
        - {from: KULTUR.Icc_Code, to: crop_id}
        - {from: KULTUR.Kultur, to: crop_id}
        #- {from: KULTUR.Kultur_Botanisch, to: crop_id}
        #- {from: KULTUR.Kultur_Englisch, to: crop_id}
        - {from: SORTE.Bsa_Code, to: SORTE.BSA_Code}
        - {from: SORTE.Sorte, to: genotype_name}
        - {from: AUSSAAT.Saatstaerke_Anzahl_m2, to: plant_pop_at_planting}
        - {from: AUSSAAT.Saatstaerke_kg_ha, to: planting_material_weight}
        #- {from: SAAT_PFLANZGUT.Keimfaehigkeit, to: CHECK}
        - {from: TECHNIK.Technik, to: planting_method}
        - {from: TECHNIK.Art, to: planting_method}
        - {from: TECHNIK.Beschreibung, to: planting_method}
        - {from: AUSSAAT.Reihenabstand, to: row_spacing}
        - {from: AUSSAAT.Pflanzenabstand, to: plant_spacing}
        - {from: BEMERKUNGEN.Bemerkungen, to: planting_notes}

    - type: map_headers
      target_section: IRRIGATIONS
      rename_list:
        - {from: Beregnung_ID, to: irrigation_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: VERSUCHSAUFBAU.Bewaesserung, to: irrig_applied}  # Note: drop? can cause error and somewhat implied
        - {from: BEREGNUNG.Termin, to: irrigation_date}
        - {from: BEREGNUNG.Menge, to: irrig_amount_depth}
        - {from: BEMERKUNGEN.Bemerkungen, to: irrig_applic_comment}

    - type: map_headers
      target_section: FERTILIZERS
      rename_list:
        - {from: Duengung_ID, to: fertilizer_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: DUENGUNG.Termin, to: fertilization_date}
        - {from: DUENGUNG.Duengemittel_Name, to: fertilizer_material}
        - {from: DUENGUNG.Masse_mineralisch, to: fertilizer_total_amount}
        - {from: TECHNIK.Technik, to: fertilizer_applic_method}
        - {from: TECHNIK.Art, to: fertilizer_applic_method}
        - {from: TECHNIK.Beschreibung, to: fertilizer_applic_method}
        - {from: DUENGUNG.Stickstoff, to: N_in_applied_fertilizer}
        - {from: DUENGUNG.Phosphor, to: phosphorus_applied_fert}
        - {from: DUENGUNG.Diaphosphorpentoxid, to: phosphorus_applied_fert}  # Note: exact match after transformation
        - {from: DUENGUNG.Kalium, to: fertilizer_K_applied}
        - {from: DUENGUNG.Dikaliumoxid, to: fertilizer_K_applied}
        - {from: DUENGUNG.Magnesium, to: Mg_in_applied_fertilizer}
        - {from: DUENGUNG.Magnesiumoxid, to: Mg_in_applied_fertilizer}
        - {from: DUENGUNG.Kalzium, to: Ca_in_applied_fertilizer}
        - {from: DUENGUNG.Calciumoxid, to: Ca_in_applied_fertilizer}
        - {from: DUENGUNG.Schwefel, to: S_in_applied_fertilizer}
        - {from: DUENGUNG.Bor, to: B_in_applied_fertilizer}
        - {from: DUENGUNG.Zink, to: Zn_in_applied_fertilizer}
        - {from: DUENGUNG.Mangan, to: Mn_in_applied_fertilizer}
        - {from: DUENGUNG.Eisen, to: Fe_in_applied_fertilizer}
        - {from: BEMERKUNGEN.Bemerkungen, to: fertiliz_applic_comment}            

    - type: map_headers
      target_section: ORGANIC_MATERIALS
      rename_list:
        - {from: Duengung_ID, to: org_materials_applic_lev}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: DUENGUNG.Termin, to: org_material_applic_date}
        - {from: DUENGUNG.Duengemittel_Name, to: organic_material}
        - {from: DUENGUNG.Frischmasse, to: org_material_applic_fresh_wt}
        - {from: DUENGUNG.Trockenmasse, to: org_material_applic_amnt}
        #- {from: DUENGUNG.Moisture, to: org_matter_moisture_conc}  # Note: add function to calculate org_matter_moisture_conc from DUENGUNG.Trockensubstanz
        - {from: TECHNIK.Technik, to: org_material_applic_meth}
        - {from: TECHNIK.Art, to: org_material_applic_meth}
        - {from: TECHNIK.Beschreibung, to: org_material_applic_meth}
        - {from: DUENGUNG.Stickstoff_In_Frischmasse, to: organic_material_N_conc}
        - {from: DUENGUNG.Stickstoff_In_Trockenmasse, to: organic_material_N_conc}  # Note: basis not mentioned in ICASA; always assuming only one method
        - {from: DUENGUNG.Phosphor_In_Frischmasse, to: organic_material_P_conc}
        - {from: DUENGUNG.Phosphor_In_Trockenmasse, to: organic_material_P_conc}
        - {from: DUENGUNG.Kalium_In_Frischmasse, to: organic_material_K_conc}
        - {from: DUENGUNG.Kalium_In_Trockenmasse, to: organic_material_K_conc}
        - {from: BEMERKUNGEN.Bemerkungen, to: org_matter_comment}

    - type: map_headers
      target_section: CHEMICALS
      rename_list:
        - {from: Pflanzenschutz_ID, to: chemical_applic_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: PFLANZENSCHUTZ.Termin, to: chemical_applic_date}
        - {from: PFLANZENSCHUTZ.Pflanzenschutzmittel_Name, to: chemical_applic_material}
        - {from: PFLANZENSCHUTZ.Pflanzenschutzmittel_Wirkstoff, to: chemical_applic_material}
        - {from: TECHNIK.Technik, to: chemical_applic_method}
        - {from: TECHNIK.Art, to: chemical_applic_method}
        - {from: TECHNIK.Beschreibung, to: chemical_applic_method}
        - {from: PFLANZENSCHUTZ.Menge_kg_ha, to: chemical_applic_amount}
        # Note: 2025-08-05 incorrect mapping (unit mismatch); ICASA does not account for liquid formulations
        - {from: PFLANZENSCHUTZ.Menge_l_ha, to: chemical_applic_amount} 
        - {from: PFLANZENSCHUTZ.Person_Nachname, to: chemical_applic_comment}
        - {from: PFLANZENSCHUTZ.Person_Vorname, to: chemical_applic_comment}
        - {from: BEMERKUNGEN.Bemerkungen, to: chemical_applic_comment}

    - type: map_headers
      target_section: TILLAGE
      rename_list:
        - {from: Bodenbearbeitung_ID, to: tillage_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: BODENBEARBEITUNG.Termin, to: tillage_date}
        - {from: BODENBEARBEITUNG.Bodenbearbeitung_Massnahme, to: tillage_operation_name}
        - {from: TECHNIK.Technik, to: tillage_implement}
        - {from: TECHNIK.Art, to: tillage_implement}
        - {from: TECHNIK.Beschreibung, to: tillage_implement}
        - {from: BODENBEARBEITUNG.Tiefe, to: tillage_operations_depth}
        - {from: BEMERKUNGEN.Bemerkungen, to: till_op_comment}

    - type: map_headers
      target_section: HARVESTS
      rename_list:
        - {from: Ernte_ID, to: harvest_operations_level}
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: ERNTE.Termin, to: harvest_operations_date}
        - {from: KULTUR.Icc_Code, to: crop_id}
        - {from: KULTUR.Kultur, to: crop_id}
        #- {from: KULTUR.Kultur_Botanisch, to: crop_id}
        #- {from: KULTUR.Kultur_Englisch, to: crop_id}
        - {from: SORTE.Bsa_Code, to: SORTE.BSA_Code}
        - {from: SORTE.Sorte, to: genotype_name}
        - {from: crop_intended_use, to: crop_intended_use}
        - {from: TECHNIK.Technik, to: harvest_method}
        - {from: TECHNIK.Art, to: harvest_method}
        - {from: TECHNIK.Beschreibung, to: harvest_method}
        - {from: BEMERKUNGEN.Bemerkungen, to: harvest_op_comments}

    - type: map_headers
      target_section: WEATHER_DAILY
      rename_list:
        - {from: KLIMADATEN.Termin, to: weather_date}
        - {from: KLIMADATEN.Globalstrahlung, to: solar_radiation}
        - {from: KLIMADATEN.T_Max_2m, to: maximum_temperature}
        - {from: KLIMADATEN.T_Min_2m, to: minimum_temperature}
        - {from: KLIMADATEN.T_Min_5cm, to: minimum_temperature}
        - {from: KLIMADATEN.T_Mit_2m, to: temp_average_daily}
        - {from: KLIMADATEN.Niederschlag_Summe, to: precipitation}
        - {from: KLIMADATEN.Wind, to: wind_speed_daily}
        - {from: KLIMADATEN.Sonnenstunden, to: daylength_sunrise_sunset}
        - {from: KLIMADATEN.Luftfeuchte, to: realtive_humidity_avg}
        - {from: KLIMADATEN.Partialdruck, to: vapor_pressure}
        - {from: KLIMADATEN.Himmel, to: weather_daily_comments}
        - {from: BEMERKUNGEN.Bemerkungen, to: weather_daily_comments}
      format_map:
        weather_date: '%Y-%m-%d'  # Note: example formatting
    
    - type: map_headers
      target_section: WEATHER_METADATA
      rename_list:
        - {from: temperature_sensor_ht, to: temperature_sensor_ht}

    - type: map_headers
      target_section: SOIL_LAYERS
      rename_list:
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: PROBENAHME_BODEN.Termin, to: date_of_measurement}
        - {from: PROBENAHME_BODEN.Obergrenze, to: me_soil_layer_top_depth}
        - {from: PROBENAHME_BODEN.Untergrenze, to: me_soil_layer_bot_depth}
        - {from: BEMERKUNGEN.Bemerkungen, to: obs_time_series_comment}

    - type: map_headers
      target_section: SUMMARY
      rename_list:
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: ERNTE.Termin, to: harvest_date}
        - {from: ERTRAG.Hp_Trockenmasse, to: harvest_yld_matur_dry_wt}
        - {from: ERTRAG.Hp_Frischmasse, to: harv_yield_matur_f_wt}
        #- {from: ERTRAG.Hp_Trockensubstanzgehalt, to: dry_matter_content}
        - {from: ERTRAG.Np_Trockenmasse, to: byprod_removed_at_harv}
        - {from: BEMERKUNGEN.Bemerkungen, to: obs_summary_comment}  # Note: 2025-08-05 not in ICASA

    - type: map_headers
      target_section: TIME_SERIES
      rename_list:
        - {from: Versuchsjahr, to: experiment_year}
        - {from: Pruefglied_ID, to: treatment_number}
        - {from: Parzelle_ID, to: plot_id}
        - {from: PROBENAHME_PFLANZEN.Termin, to: date_of_measurement}
        - {from: PFLANZENLABORWERTE.Hp_Trockenmasse, to: harvest_yield_at_day_dw}
        - {from: yield_moisture_content, to: yield_moisture_content}
        #- {from: ERTRAG.Hp_Trockenmasse, to: harvest_yield_at_day_dw}  # Note: conditional routing on harvest date
        #- {from: ERTRAG.Hp_Frischmasse, to: harvest_yield_fresh_wt}
        #- {from: ERTRAG.Hp_Trockensubstanzgehalt, to: yield_dry_matter_content}
        #- {from: ERTRAG.Np_Trockenmasse, to: dead_canopy_dry_wt}
        - {from: PFLANZENLABORWERTE.Stickstoff, to: grain_N_conc}
        - {from: grain_N_content, to: grain_N}
        - {from: PFLANZENLABORWERTE.Phosphor, to: grain_P_conc}
        - {from: grain_P_content, to: grain_P}
        - {from: grain_K_content, to: grain_K}
        - {from: grain_unit_weight, to: grain_unit_dry_weight}
        - {from: PFLANZENLABORWERTE.Protein, to: grain_protein_concentration}
        - {from: PFLANZENLABORWERTE.Oel, to: grain_oil_conc}
        - {from: BEMERKUNGEN.Bemerkungen, to: obs_time_series_comment}

